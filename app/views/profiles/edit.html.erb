<div class="min-h-screen bg-linear-to-br from-slate-950 via-slate-900 to-slate-950 py-8 px-4 sm:px-6 lg:px-8">
  <!-- Animated Background Orbs -->
  <div class="fixed inset-0 overflow-hidden pointer-events-none">
    <div class="absolute top-0 left-1/4 w-96 h-96 bg-purple-500/20 rounded-full blur-3xl animate-pulse"></div>
    <div class="absolute bottom-0 right-1/4 w-96 h-96 bg-pink-500/20 rounded-full blur-3xl animate-pulse" style="animation-delay: 2s;"></div>
    <div class="absolute top-1/2 right-0 w-96 h-96 bg-indigo-500/20 rounded-full blur-3xl animate-pulse" style="animation-delay: 4s;"></div>
  </div>

  <!-- Content -->
  <div class="relative z-10">
    <div class="max-w-2xl mx-auto bg-slate-800/50 backdrop-blur-lg border border-slate-700/50 rounded-xl shadow-2xl p-8">
      <!-- Header -->
      <div class="mb-10">
        <h1 class="text-4xl md:text-5xl font-black bg-linear-to-r from-purple-300 via-pink-300 to-indigo-300 bg-clip-text text-transparent">Edit Profile</h1>
        <p class="text-slate-400 mt-3 text-lg">Update your profile information and appearance</p>
      </div>

      <!-- Form -->
      <%= form_with model: @profile, url: profile_path(@profile.username), local: true, method: :patch, class: "space-y-8" do |form| %>
        <!-- Error Messages -->
        <% if @profile.errors.any? %>
          <div class="bg-red-950/50 border-l-4 border-red-500 backdrop-blur p-5 rounded-r-lg">
            <h3 class="font-bold text-red-300 mb-3">
              <%= pluralize(@profile.errors.count, "error") %> found:
            </h3>
            <ul class="list-disc list-inside text-red-200 text-sm space-y-1">
              <% @profile.errors.full_messages.each do |message| %>
                <li><%= message %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <!-- Avatar Section -->
        <fieldset class="space-y-4 pb-6 border-b border-slate-700/50">
          <legend class="text-lg font-bold text-slate-100">Profile Picture</legend>
          <p class="text-sm text-slate-400">Upload a profile picture (up to 5MB, JPEG/PNG/GIF/WebP)</p>

          <div class="flex items-center gap-6">
            <!-- Current Avatar Preview -->
            <div class="shrink-0">
              <% if @profile.avatar.attached? %>
                <%= image_tag @profile.avatar, alt: "Current Avatar", class: "w-24 h-24 rounded-full object-cover border-2 border-purple-500/50 ring-2 ring-purple-500/30 shadow-lg shadow-purple-500/20" %>
              <% else %>
                <div class="w-24 h-24 rounded-full bg-slate-700/50 backdrop-blur flex items-center justify-center border-2 border-purple-500/50 ring-2 ring-purple-500/30">
                  <svg class="w-12 h-12 text-purple-400/50" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                  </svg>
                </div>
              <% end %>
            </div>

            <!-- Upload Input -->
            <div class="flex-1">
              <%= form.file_field :avatar, accept: "image/jpeg,image/png,image/gif,image/webp", 
                  class: "block w-full px-4 py-2 border border-slate-600/50 backdrop-blur bg-slate-700/30 rounded-lg text-slate-300 placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition" %>
              <p class="text-xs text-slate-500 mt-2">Leave empty to keep current picture</p>
            </div>
          </div>
        </fieldset>

        <!-- Banner Section -->
        <fieldset class="space-y-4 pb-6 border-b border-slate-700/50">
          <legend class="text-lg font-bold text-slate-100">Profile Banner</legend>
          <p class="text-sm text-slate-400">Upload a banner image (up to 5MB, JPEG/PNG/GIF/WebP)</p>

          <!-- Current Banner Preview -->
          <div class="rounded-lg border border-slate-600/50 overflow-hidden bg-slate-700/30 backdrop-blur">
            <% if @profile.banner.attached? %>
              <%= image_tag @profile.banner, alt: "Current Banner", class: "w-full h-32 object-cover hover:scale-105 transition duration-300" %>
            <% else %>
              <div class="w-full h-32 bg-linear-to-r from-purple-600/40 via-pink-600/40 to-indigo-600/40 flex items-center justify-center">
                <svg class="w-8 h-8 text-purple-400/50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
              </div>
            <% end %>
          </div>

          <!-- Upload Input -->
          <div>
            <%= form.file_field :banner, accept: "image/jpeg,image/png,image/gif,image/webp", 
                class: "block w-full px-4 py-2 border border-slate-600/50 backdrop-blur bg-slate-700/30 rounded-lg text-slate-300 placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition" %>
            <p class="text-xs text-slate-500 mt-2">Leave empty to keep current banner</p>
          </div>
        </fieldset>

        <!-- Username Field -->
        <fieldset class="space-y-4 pb-6 border-b border-slate-700/50">
          <legend class="text-lg font-bold text-slate-100">Username</legend>
          <p class="text-sm text-slate-400">3-30 characters, letters/numbers/underscores only</p>

          <div>
            <div class="relative">
              <span class="absolute left-4 top-1/2 transform -translate-y-1/2 text-purple-400 font-bold">@</span>
              <%= form.text_field :username, 
                  class: "w-full pl-8 pr-4 py-2 border border-slate-600/50 backdrop-blur bg-slate-700/30 rounded-lg text-slate-100 placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition",
                  placeholder: "username" %>
            </div>
            <p class="text-xs text-slate-500 mt-2">Usernames are unique and cannot be easily changed</p>
          </div>
        </fieldset>

        <!-- Bio Field -->
        <fieldset class="space-y-4 pb-6 border-b border-slate-700/50">
          <legend class="text-lg font-bold text-slate-100">Bio</legend>
          <p class="text-sm text-slate-400">Tell us about yourself (up to 500 characters)</p>

          <div>
            <%= form.text_area :bio, 
                rows: 4,
                class: "w-full px-4 py-2 border border-slate-600/50 backdrop-blur bg-slate-700/30 rounded-lg text-slate-100 placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition resize-none",
                placeholder: "Share a little about yourself..." %>
            <div class="flex justify-between mt-3">
              <p class="text-xs text-slate-500">
                <span id="bio-count">0</span> / 500 characters
              </p>
            </div>
          </div>
        </fieldset>

        <!-- Action Buttons -->
        <div class="flex gap-4 pt-6">
          <%= form.submit "Save Changes", 
              class: "px-6 py-3 bg-linear-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white font-bold rounded-lg transition duration-300 shadow-lg hover:shadow-purple-500/50 transform hover:scale-105" %>
          <%= link_to "Cancel", profile_path(@profile.username), 
              class: "px-6 py-3 bg-slate-700/50 hover:bg-slate-700 text-slate-200 font-semibold rounded-lg transition duration-300 backdrop-blur" %>
        </div>
      <% end %>

      <!-- Help Text -->
      <div class="mt-10 p-6 bg-linear-to-r from-purple-900/30 to-pink-900/30 backdrop-blur border border-purple-500/30 rounded-lg">
        <h4 class="font-bold text-purple-200 mb-3">Profile Tips</h4>
        <ul class="text-sm text-purple-300 space-y-2">
          <li class="flex items-start gap-2">
            <span class="text-purple-400 mt-1">✓</span>
            <span>Use a clear, recognizable profile picture for better interactions</span>
          </li>
          <li class="flex items-start gap-2">
            <span class="text-purple-400 mt-1">✓</span>
            <span>Your username is publicly visible and helps others find you</span>
          </li>
          <li class="flex items-start gap-2">
            <span class="text-purple-400 mt-1">✓</span>
            <span>Write a bio that describes your interests in anime</span>
          </li>
          <li class="flex items-start gap-2">
            <span class="text-purple-400 mt-1">✓</span>
            <span>A banner image can showcase your style and personality</span>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>

<!-- Character Counter for Bio -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const bioField = document.querySelector('textarea[id="profile_bio"]');
  const bioCount = document.getElementById('bio-count');
  
  if (bioField && bioCount) {
    function updateCount() {
      bioCount.textContent = bioField.value.length;
    }
    
    bioField.addEventListener('input', updateCount);
    updateCount();
  }
});
</script>
