# Migration Template Guide
# Place these migrations in db/migrate/ folder
# Name format: YYYYMMDDHHMMSS_migration_name.rb

# ============================================================
# PHASE 1 MIGRATIONS: Foundation & User Authentication
# Run these first
# ============================================================

# Migration 1: Create Profiles Table
# File: db/migrate/[timestamp]_create_profiles.rb
# Generated by: Member 1
#
# rails generate migration CreateProfiles

class CreateProfiles < ActiveRecord::Migration[8.1]
  def change
    create_table :profiles do |t|
      t.references :user, null: false, foreign_key: true
      t.string :username, null: false
      t.text :bio
      t.timestamps
    end
    add_index :profiles, :username, unique: true
  end
end


# ============================================================
# PHASE 2 MIGRATIONS: Posts & Media
# After Phase 1 is complete
# ============================================================

# Migration 2: Create Posts Table
# File: db/migrate/[timestamp]_create_posts.rb
# Generated by: Member 2
#
# rails generate model Post user:references title:string content:text

class CreatePosts < ActiveRecord::Migration[8.1]
  def change
    create_table :posts do |t|
      t.references :user, null: false, foreign_key: true
      t.string :title, null: false, limit: 200
      t.text :content, null: false
      t.timestamps
    end
    add_index :posts, [:user_id, :created_at]
  end
end


# ============================================================
# PHASE 3 MIGRATIONS: Social Features
# After Phase 2 is complete
# ============================================================

# Migration 3: Create Comments Table
# File: db/migrate/[timestamp]_create_comments.rb
# Generated by: Member 3
#
# rails generate model Comment user:references post:references parent_comment:references content:text

class CreateComments < ActiveRecord::Migration[8.1]
  def change
    create_table :comments do |t|
      t.references :user, null: false, foreign_key: true
      t.references :post, null: false, foreign_key: true
      t.references :parent_comment, foreign_key: { to_table: :comments }
      t.text :content, null: false
      t.timestamps
    end
    add_index :comments, [:post_id, :created_at]
  end
end


# Migration 4: Create Likes Table
# File: db/migrate/[timestamp]_create_likes.rb
# Generated by: Member 3
#
# rails generate model Like user:references post:references

class CreateLikes < ActiveRecord::Migration[8.1]
  def change
    create_table :likes do |t|
      t.references :user, null: false, foreign_key: true
      t.references :post, null: false, foreign_key: true
      t.timestamps
    end
    add_index :likes, [:user_id, :post_id], unique: true
  end
end


# Migration 5: Create Reactions Table
# File: db/migrate/[timestamp]_create_reactions.rb
# Generated by: Member 3
#
# rails generate model Reaction user:references post:references reaction_type:string

class CreateReactions < ActiveRecord::Migration[8.1]
  def change
    create_table :reactions do |t|
      t.references :user, null: false, foreign_key: true
      t.references :post, null: false, foreign_key: true
      t.string :reaction_type, null: false
      t.timestamps
    end
    add_index :reactions, [:user_id, :post_id, :reaction_type], unique: true
  end
end


# Migration 6: Create Friendships Table
# File: db/migrate/[timestamp]_create_friendships.rb
# Generated by: Member 3
#
# rails generate model Friendship user:references friend:references status:string

class CreateFriendships < ActiveRecord::Migration[8.1]
  def change
    create_table :friendships do |t|
      t.references :user, null: false, foreign_key: true
      t.references :friend, null: false, foreign_key: { to_table: :users }
      t.string :status, null: false, default: 'pending'
      t.timestamps
    end
    add_index :friendships, [:user_id, :friend_id], unique: true
    add_index :friendships, [:friend_id, :status]
  end
end


# ============================================================
# PHASE 4 MIGRATIONS: Real-time Notifications
# After Phase 3 is complete
# ============================================================

# Migration 7: Create Notifications Table
# File: db/migrate/[timestamp]_create_notifications.rb
# Generated by: Member 3
#
# rails generate model Notification user:references notifiable:polymorphic notification_type:string read_at:datetime

class CreateNotifications < ActiveRecord::Migration[8.1]
  def change
    create_table :notifications do |t|
      t.references :user, null: false, foreign_key: true
      t.references :notifiable, polymorphic: true, null: false
      t.string :notification_type, null: false
      t.datetime :read_at
      t.timestamps
    end
    add_index :notifications, [:user_id, :created_at]
    add_index :notifications, [:user_id, :read_at]
  end
end


# ============================================================
# PHASE 4B: Active Storage Setup
# Member 2: Image uploads
#
# Run: rails active_storage:install; rails db:migrate
# ============================================================

# This creates:
# - active_storage_blobs table
# - active_storage_attachments table
# - active_storage_variant_records table


# ============================================================
# Usage Guide
# ============================================================
#
# To CREATE a new migration:
# $ rails generate migration CreateTableName
#
# To RUN all pending migrations:
# $ rails db:migrate
#
# To ROLLBACK last migration:
# $ rails db:rollback
#
# To ROLLBACK to specific version:
# $ rails db:migrate VERSION=20260218120000
#
# To REDO last migration:
# $ rails db:migrate:redo
#
# To see migration status:
# $ rails db:migrate:status
